# 📘《小墨 Demo Proposal》

## 1. Demo 总览
- Demo 的核心目的：展示一套纯前端的 AI 学习操作系统雏形，从“立目标 → 拆任务 → 记笔记 → 复习”一路串起来，让大模型接手时能立刻理解该怎么继续扩建。
- Demo 的使用场景：适合临近期中期末、考研冲刺，或者需要自学某门课的大学生，尤其是手头只有零散资料、需要 AI 帮忙规划与复盘的用户。
- Demo 所演示的关键价值：目标画像和任务树调度、学习工作台与 Markdown 笔记的联动、知识库分类与 RAG 数据可视化、AI 对话回放和 Review Lab 的推理透明度。
- 现阶段的成熟度与依赖：完全跑在浏览器里，用 Vite + TypeScript + 原生 DOM，所有数据（目标、任务树、知识库、复习题库）都通过 JSON 模板驱动，展示逻辑已齐全，但尚未连接真实后端或在线大模型。

## 2. 核心功能总结
| 功能 | 目的 | 输入 / 输出 | 与其他模块的互动 | 状态 |
| --- | --- | --- | --- | --- |
| 目标驾驶舱 | 汇总活跃目标、剩余时间、CTA | 读取全局快照中的目标列表与统计 | 点击按钮可跳转到目标创建、知识库或目标工作区 | 已完成 |
| 目标创建流程 | 模拟“基础信息→资料→AI 生成”三段式建目标 | 草稿状态、创建流程状态、预设列表、知识库预览 | 可导入知识库条目、处理多文件上传，最终调用建目标动作 | 已完成 |
| 任务树与画像工作区 | 展示 persona、剩余时间、策略线以及分层任务树 | 当前激活目标 | 可标记任务完成、唤起学习工作台、触发 toast | 已完成 |
| 学习工作台 | 将 lesson Markdown、矩形选区、笔记系统整合在一屏 | 当前工作资产、关联笔记、AI 菜单预设 | 可返回任务树、抓取选区生成提问、把笔记同步到知识库 | 已完成 |
| Markdown 笔记 | 提供标题+正文+可选预览的编辑体验 | 当前 tab 或 workspace 传入的笔记对象 | 改标题/正文会实时写回全局状态，可一键创建或打开笔记 | 已完成 |
| 知识库管理 | 分类看板 + 条目列表 + 上传记录 + 学科库切换 | 知识库状态、库列表 | 拖放条目与分类、导入资料到目标创建草稿、创建分类 | 已完成 |
| AI 对话回放 | 演示有引用溯源的辅导对话 | 预置对话记录、当前目标元数据 | 播放时读取来源标签，与其它模块共享 persona 背景 | 已完成 |
| Review Lab | 统一题库引擎（卡片/单选/多选/匹配/填空/简答） | 预置题目、个性化上下文 | 根据答题状态更新时间轴和反馈，未来可写回目标统计 | 已完成 |
| Shell 导航与标签 | 固定侧边导航 + 可拖拽标签+ toast 区 | 全局快照中的当前页面与标签列表 | 负责把各功能模块挂到内容区域，并同步 sidebar/meta | 已完成 |
| 系统设置 | 管理全局配置（当前只有 Markdown 预览开关） | 配置状态 | 切换开关会影响笔记编辑器与学习工作台中的预览 | 已完成 |

## 3. 关键模块解析
- **中央状态调度器**：负责初始化默认目标、today route、任务树、知识库、notes、工作台资产与全局配置，也是所有事件（导航、创建目标、记录上传、切换库、toast）唯一入口。Tab 管理器、知识库管理器都注入在这里，确保任意模块都能安全读写状态。
- **目标创建子系统**：包含草稿数据、流程进度、预设模版与高级设置逻辑，资料阶段可以上传文件或直接把知识库条目批量拉进草稿，生成阶段用前端计时模拟 AI 运转，完成后自动生成新目标、today route、weekly plan，并开出目标工作区标签。
- **任务树/画像面板**：从当前目标中拆出 persona（剩余时间、目标分、偏好、弱项）、策略线、任务树节点。每个节点都有 chunk steps、persona 调度提示、“为什么要做”说明，可展开/折叠、标记完成或跳入学习工作台。
- **学习工作台 + 笔记一体化**：左侧呈现 Markdown lesson（支持 KaTeX），有 Alt+拖拽的矩形选框，浮出一组“解释/示例/复习/关联/笔记/练习/工具”按钮，方便以后把选区喂给 Gemini。右侧是可折叠的笔记系统，自动关联当前任务并支持一键“收录到知识库”。
- **知识库管理器**：封装分类新增、重命名、删除、拖放、上传、记录笔记等逻辑。确保“未分类”和“笔记”两个分类永远存在，上传记录会生成醒目的高亮条目，切换学科库时自动重建 notes 种子。
- **Review Lab 引擎**：统一处理 6 种题型，题面、提示、反馈全部可以带变量，实时插入 persona、剩余天数、资料来源等信息。还提供题目时间轴、进度条、反馈卡片、flashcard 翻转、匹配画线、简答关键词判定等交互。
- **AI 对话舞台**：预先写好多段“学生 vs 小墨”案例，播放时带有 thinking 状态、打字效果、引用列表，可快速替换成真人对话或即时生成结果。
- **Shell 组件**：包含侧边导航、tab strip、sidebar meta、toast 区、可拖动的 nav 宽度。所有页面都实现同一 render 接口，shell 只负责挂载和路由，方便后续扩充页面。
- **学科注册表**：集中管理不同学科的默认目标、任务树、知识库、课程 Markdown，切换学科只用调用一个入口即可替换整套数据。

## 4. Demo 运行流程（用户视角）
1. 打开页面就看到目标驾驶舱：系统自动加载默认的微积分目标，显示剩余天数、进度、CTA，侧边栏同步展示进度条。
2. 用户若想新建目标，进入创建流程：
   - 在基础阶段选科目、预设、时间模式，系统会自动补齐高级选项。
   - 在资料阶段可以拖文件、粘贴链接、直接导入知识库条目，材料会长留在草稿里。
   - 在生成阶段看到 AI “解析资料 → 构建章节 → 提取考点 → 生成路线” 的进度动画，完成后自动落地一个新的目标并跳转到工作区。
3. 在任务树页面，用户能阅读 persona、策略、剩余时间，也能展开任何任务节点查看拆解步骤、Why block，点击“开始学习”即可进入学习工作台。
4. 学习工作台会根据任务自动加载 Lesson Markdown 或自动合成的任务笔记，左侧可框选生成提问，右侧笔记区会跟任务绑定，还能一键“收录知识库”。
5. 切到知识库页面，可以拖动分类、移动条目、上传资料、创建自定义分类，上传的文件会以高亮形式出现在列表里，点击某条目还能定位回相关笔记。
6. 想体验 AI 反馈时，进入 Review Lab，系统会按 persona 渲染提示和反馈，用户刷完题目后看到时间轴更新、进度条前进；也可以切到 AI 对话舞台回放真实案例，观察 AI 如何引用资料、指出错因、安排冲刺路线。
7. 全流程中 toast 会提示“笔记已收录”“学习进度已同步”等，说明“目标 → 执行 → 复盘”已经闭环。

## 5. 功能链路拆解（AI Agent 视角）
- **链路 A：建目标 → 任务树 → 学习台**
  - 输入：用户在创建流程中填的草稿（科目、预设、时间、资料）。
  - 输出：一份完整的 Study Goal（含 persona、today route、任务树、周计划）。
  - 基础逻辑：前端 factory 按预设生成骨架，并在插入新目标后打开对应的工作区。
  - 可扩展：把占位逻辑换成 Gemini 真实推理，或者让 Gemini 直接写入任务树与 persona。

- **链路 B：学习台 → Markdown 笔记 → 知识库 → Review Lab**
  - 输入：当前活跃任务、工作台资产、关联笔记。
  - 输出：任务专属笔记、知识库 notes 分类条目、复习题目里的引用文案。
  - 基础逻辑：学习台确保每个任务都有一份笔记，收录时自动写入知识库；Review Lab 读取这些条目生成提示。
  - 可扩展：矩形选区直接触发 Gemini 解析；Review Lab 结果写回目标，驱动二次调度。

- **链路 C：知识库 → 建目标资料池**
  - 输入：当前知识库里的分类与条目。
  - 输出：目标创建“资料预览”区域的列表，一键注入草稿材料。
  - 基础逻辑：创建流程会把知识库展平为 preview 列表，点击“导入”即可同步到材料数组。
  - 可扩展：让 Gemini 自动从条目内容提炼关键信息并排序，帮助用户挑资料。

- **链路 D：Persona → 对话/复习语气**
  - 输入：目标画像（剩余时间、目标分、偏好、弱项、约束）。
  - 输出：Review Lab 的提示文案、AI 对话标签、Goal Workspace 的 persona 面板。
  - 基础逻辑：上下文渲染时用模板变量替换 persona 字段，确保所有模块语气一致。
  - 可扩展：让 Gemini 根据用户表现动态刷新 persona，再反哺任务排序与反馈语气。

## 6. 设计理念总结
- **系统级闭环**：所有数据都围绕一个状态树，从规划到执行再到复盘全部串在一起，让学生看到“目标-任务-学习-复习”是同一个主线。
- **个性化驱动**：预设、维度、persona、任务节点的标签都强调“根据画像调策略”，不论是 AI 对话还是 Review Lab，都能换上不同语气和提示。
- **知识沉淀**：任何资料、笔记、上传都会落在知识库的某个分类里，且可以再次回流到目标创建或复习环节，保证“学过的内容都有出处”。
- **状态可视**：驾驶舱、sidebar、任务树、Review Lab 时间轴都让用户实时感知进度和剩余压力，避免学到一半迷失方向。
- **AI 协作**：矩形选区 + QA 菜单、AI 对话引用、Review Lab 反馈，全部强调“AI 提供策略，用户执行，系统自动记录”的合作范式。
- **教育学逻辑**：today route + weekly plan 管日常节奏，任务树 chunk steps 做“拆解→练习→复盘”，Review Lab 强化主动回忆，Goal Creation 的倒计时模式强调冲刺心智，这些理念都可直接由 Gemini 执行。

## 7. Demo MVP 范围建议
- **必须呈现**：
  1. 目标驾驶舱 + 三段式建目标（突出 AI 规划）。
  2. 任务树 + persona 面板 + 学习工作台（展示“任务 → 笔记 → 学习”联动）。
  3. Markdown 笔记与知识库同步（证明知识沉淀闭环）。
  4. Review Lab 至少三种题型，包含个性化提示（体现 AI 复习引擎）。
- **可选亮点**：
  1. AI 对话回放，用来秀 RAG 透明度。
  2. 多知识库切换、拖拽、上传动画等交互细节。
  3. 学习工作台的矩形选区与 Alt 快捷方式。
- **暂缓投入**：
  1. 额外学科的整套数据。
  2. 复杂的 persona 编辑器或数据图表。
  3. 语音/音视频互动。

## 8. 扩展空间（给 Gemini 的自由发挥区）
- **不设限制**：界面视觉、布局、动画、主题完全可以重做，只要保持模块化易维护即可。
- **交给 Gemini 决策**：
  1. 真实 AI 推理——建目标、学习工作台问答、Review Lab 判分都可以直接调用 Gemini。
  2. 数据持久化方案——本地 IndexedDB、云端同步、团队协作等都可自行设计。
  3. Persona 演化机制——根据学习表现动态更新偏好与策略，再影响任务排序。
- **创意方向**：
  1. 把矩形选区直接接 Gemini Prompt，做到圈选即问即答。
  2. 让 Review Lab 结果反推新任务或自动生成笔记要点。
  3. 知识库条目自动生成摘要、难度、可信度评分，打造真正的 RAG Vault。
  4. 把 AI 对话舞台升级成多轮 Agent，让 Gemini 主动调用“任务树/知识库/笔记”接口取材。
